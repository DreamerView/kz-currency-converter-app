<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤–∞–ª—é—Ç –ù–ë –†–ö</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/autonumeric@4.6.0" defer></script>
  <link rel="manifest" href="/manifest.json"/>
  <style>
    body { padding: 2rem; }
    .currency-suffix {
      font-weight: bold;
      text-transform: uppercase;
    }
    @keyframes fadeInOut {
      0%, 100% { opacity: 0.3; }
      50%       { opacity: 1; }
    }

    #loading {
      animation: fadeInOut 1.5s ease-in-out infinite;
    }
  </style>
</head>
<body class="bg-light container d-flex flex-column justify-content-center align-items-center">

  <h2 class="text-center mt-5 m-0">üí± –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤–∞–ª—é—Ç –ù–ë –†–ö</h2>

  <h5 class="m-0 my-5 text-center lh-lg" id="loading" style="max-width: 550px;width:100%;">–ó–∞–≥—Ä—É–∑–∫–∞ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ ‚Äî –ø–æ–ª–µ –ø–æ—è–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏.</h5>

  <div id="response" class="row mt-4 pt-5 mx-auto d-none" id="converter" style="max-width: 550px;width:100%;">
    <div class="col-12 mb-4">
        <label class="form-label">–°—É–º–º–∞</label>
        <input id="amount" type="tel" class="form-control fs-5" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 100" autocomplete="off">
    </div>
    <div class="col-5">
        <label class="form-label">–ò–∑</label>
        <select id="fromCurrency" class="form-select"></select>
    </div>
    <div class="col-2 d-flex justify-content-center align-items-end">
        <button class="btn btn-secondary rounded-5 w-100" onclick="swapCurrencies()">‚Üî</button>
    </div>
    <div class="col-5">
        <label class="form-label">–í</label>
        <select id="toCurrency" class="form-select"></select>
    </div>
    <div class="col-12 mt-4">
        <label class="form-label">–†–µ–∑—É–ª—å—Ç–∞—Ç</label>
        <div class="form-control bg-body-secondary d-flex justify-content-between align-items-center fs-5">
          <span id="result">0.00</span>
          <span class="currency-suffix" id="currencyLabel">KZT</span>
        </div>
    </div>
    <div class="col-12 mt-5 d-flex flex-column align-items-center">
        <p class="m-0 text-center">–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã —Å —Å–∞–π—Ç–∞</p>
        <a class="text-center" href="https://www.nationalbank.kz/ru">–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫–∞ –†–µ—Å–ø—É–±–ª–∏–∫–∏ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω</a>
    </div> 
  </div>
  <footer class="text-center mt-4 border-top">
        <p></p>Built with ‚ù§Ô∏è by <strong>Temirkhan</strong></p>
        <p>Project at <a target="_blank" href="https://github.com/DreamerView/kz-currency-converter-app">Github</a></p>
    </footer>

  <script>
    const currencyMap = {};
    const currencyNames = {
  "AUD": "–ê–≤—Å—Ç—Ä–∞–ª–∏–π—Å–∫–∏–π –¥–æ–ª–ª–∞—Ä üá¶üá∫",
  "AZN": "–ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω—Å–∫–∏–π –º–∞–Ω–∞—Ç üá¶üáø",
  "AMD": "–ê—Ä–º—è–Ω—Å–∫–∏–π –¥—Ä–∞–º üá¶üá≤",
  "BYN": "–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —Ä—É–±–ª—å üáßüáæ",
  "BRL": "–ë—Ä–∞–∑–∏–ª—å—Å–∫–∏–π —Ä–µ–∞–ª üáßüá∑",
  "HUF": "–í–µ–Ω–≥–µ—Ä—Å–∫–∏–π —Ñ–æ—Ä–∏–Ω—Ç üá≠üá∫",
  "HKD": "–ì–æ–Ω–∫–æ–Ω–≥—Å–∫–∏–π –¥–æ–ª–ª–∞—Ä üá≠üá∞",
  "GEL": "–ì—Ä—É–∑–∏–Ω—Å–∫–∏–π –ª–∞—Ä–∏ üá¨üá™",
  "DKK": "–î–∞—Ç—Å–∫–∞—è –∫—Ä–æ–Ω–∞ üá©üá∞",
  "AED": "–î–∏—Ä—Ö–∞–º –û–ê–≠ üá¶üá™",
  "USD": "–î–æ–ª–ª–∞—Ä –°–®–ê üá∫üá∏",
  "EUR": "–ï–≤—Ä–æ üá™üá∫",
  "INR": "–ò–Ω–¥–∏–π—Å–∫–∞—è —Ä—É–ø–∏—è üáÆüá≥",
  "IRR": "–ò—Ä–∞–Ω—Å–∫–∏–π —Ä–∏–∞–ª üáÆüá∑",
  "CAD": "–ö–∞–Ω–∞–¥—Å–∫–∏–π –¥–æ–ª–ª–∞—Ä üá®üá¶",
  "CNY": "–ö–∏—Ç–∞–π—Å–∫–∏–π —é–∞–Ω—å üá®üá≥",
  "KWD": "–ö—É–≤–µ–π—Ç—Å–∫–∏–π –¥–∏–Ω–∞—Ä üá∞üáº",
  "KGS": "–ö–∏—Ä–≥–∏–∑—Å–∫–∏–π —Å–æ–º üá∞üá¨",
  "MYR": "–ú–∞–ª–∞–π–∑–∏–π—Å–∫–∏–π —Ä–∏–Ω–≥–≥–∏—Ç üá≤üáæ",
  "MXN": "–ú–µ–∫—Å–∏–∫–∞–Ω—Å–∫–æ–µ –ø–µ—Å–æ üá≤üáΩ",
  "MDL": "–ú–æ–ª–¥–∞–≤—Å–∫–∏–π –ª–µ–π üá≤üá©",
  "NOK": "–ù–æ—Ä–≤–µ–∂—Å–∫–∞—è –∫—Ä–æ–Ω–∞ üá≥üá¥",
  "PLN": "–ü–æ–ª—å—Å–∫–∏–π –∑–ª–æ—Ç—ã–π üáµüá±",
  "SAR": "–°–∞—É–¥–æ–≤—Å–∫–∏–π —Ä–∏—è–ª üá∏üá¶",
  "RUB": "–†–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—É–±–ª—å üá∑üá∫",
  "XDR": "–°–î–† (—Å–ø–µ—Ü–ø—Ä–∞–≤–∞) üåê",
  "SGD": "–°–∏–Ω–≥–∞–ø—É—Ä—Å–∫–∏–π –¥–æ–ª–ª–∞—Ä üá∏üá¨",
  "TJS": "–¢–∞–¥–∂–∏–∫—Å–∫–∏–π —Å–æ–º–æ–Ω–∏ üáπüáØ",
  "THB": "–¢–∞–π—Å–∫–∏–π –±–∞—Ç üáπüá≠",
  "TRY": "–¢—É—Ä–µ—Ü–∫–∞—è –ª–∏—Ä–∞ üáπüá∑",
  "UZS": "–£–∑–±–µ–∫—Å–∫–∏–π —Å—É–º üá∫üáø",
  "UAH": "–£–∫—Ä–∞–∏–Ω—Å–∫–∞—è –≥—Ä–∏–≤–Ω–∞ üá∫üá¶",
  "GBP": "–§—É–Ω—Ç —Å—Ç–µ—Ä–ª–∏–Ω–≥–æ–≤ üá¨üáß",
  "CZK": "–ß–µ—à—Å–∫–∞—è –∫—Ä–æ–Ω–∞ üá®üáø",
  "SEK": "–®–≤–µ–¥—Å–∫–∞—è –∫—Ä–æ–Ω–∞ üá∏üá™",
  "CHF": "–®–≤–µ–π—Ü–∞—Ä—Å–∫–∏–π —Ñ—Ä–∞–Ω–∫ üá®üá≠",
  "ZAR": "–Æ–∂–Ω–æ–∞—Ñ—Ä–∏–∫–∞–Ω—Å–∫–∏–π —Ä—ç–Ω–¥ üáøüá¶",
  "KRW": "–Æ–∂–Ω–æ–∫–æ—Ä–µ–π—Å–∫–∞—è –≤–æ–Ω–∞ üá∞üá∑",
  "JPY": "–Ø–ø–æ–Ω—Å–∫–∞—è –∏–µ–Ω–∞ üáØüáµ",
  "KZT": "–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω—Å–∫–∏–π —Ç–µ–Ω–≥–µ üá∞üáø"
};

    let amountInput, resultOutput;

    const updateResult = () => {
      const amount = parseFloat(amountInput.rawValue.replace(/\s/g, ''));
      const from = document.getElementById("fromCurrency").value;
      const to = document.getElementById("toCurrency").value;
      document.getElementById("currencyLabel").textContent = to;
      if (!from || !to || isNaN(amount)) return resultOutput.set(0);
      const converted = amount * (currencyMap[from] / currencyMap[to]);
      resultOutput.set(converted);
    };

    const swapCurrencies = () => {
      const from = document.getElementById("fromCurrency");
      const to = document.getElementById("toCurrency");
      [from.value, to.value] = [to.value, from.value];
      updateResult();
    };

    const loadCurrency = async () => {
      try {
        const res = await fetch("https://api.allorigins.win/raw?url=https://nationalbank.kz/rss/rates_all.xml");
        const xml = await res.text();
        localStorage.setItem("currency", xml);
        localStorage.setItem("currency_time", new Date().toISOString());
        renderCurrency(xml);
        showOfflineNotice(false);
      } catch (e) {
        const cached = localStorage.getItem("currency");
        const cachedTime = localStorage.getItem("currency_time");
        if (cached && cachedTime) {
          renderCurrency(cached);
          showOfflineNotice(true, cachedTime);
        } else {
          alert("–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç.");
        }
      }
      finally {
        document.getElementById("loading").classList.add("d-none");
        document.getElementById("response").classList.remove("d-none");
      }
    };

    const renderCurrency = xmlStr => {
      const xml = new DOMParser().parseFromString(xmlStr, "text/xml");
      const items = [...xml.querySelectorAll("item")];
      const fromSelect = document.getElementById("fromCurrency");
      const toSelect = document.getElementById("toCurrency");

      currencyMap["KZT"] = 1;
      fromSelect.innerHTML = toSelect.innerHTML = '';

      const allCodes = ["KZT"];

      items.forEach(item => {
        const code = item.querySelector("title")?.textContent;
        const rate = parseFloat(item.querySelector("description")?.textContent);
        const quant = parseFloat(item.querySelector("quant")?.textContent);
        const value = rate / quant;
        currencyMap[code] = value;
        allCodes.push(code);
      });

      allCodes.forEach(code => {
        const label = currencyNames[code] || code;
        const option = `<option value="${code}" title="${label}">${label}</option>`;
        fromSelect.innerHTML += option;
        toSelect.innerHTML += option;
      });

      fromSelect.value = "KZT";
      toSelect.value = "USD";
      document.getElementById("currencyLabel").textContent = "USD";
      updateResult();
    };

    window.addEventListener("load", () => {
      loadCurrency();
      amountInput = new AutoNumeric("#amount", {
        digitGroupSeparator: ' ',
        decimalCharacter: '.',
        decimalPlaces: 2
      });
      resultOutput = new AutoNumeric("#result", {
        readOnly: true,
        watchExternalChanges: true,
        digitGroupSeparator: ' ',
        decimalCharacter: '.',
        decimalPlaces: 2
      });
    });

    document.getElementById("fromCurrency").addEventListener("change", updateResult);
    document.getElementById("toCurrency").addEventListener("change", updateResult);
    document.getElementById("amount").addEventListener("input", updateResult);

    function showOfflineNotice(offline, time) {
      let notice = document.getElementById("offlineNotice");
      if (!notice) {
        notice = document.createElement("div");
        notice.id = "offlineNotice";
        notice.className = "alert alert-warning text-center mt-3";
        document.getElementById("converter").prepend(notice);
      }
      notice.style.display = offline ? 'block' : 'none';
      if (offline) {
        const d = new Date(time);
        notice.textContent = `‚ö†Ô∏è –í—ã –æ—Ñ–ª–∞–π–Ω. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –æ—Ç ${d.toLocaleString()}`;
      }
    }
  </script>
</body>
</html>